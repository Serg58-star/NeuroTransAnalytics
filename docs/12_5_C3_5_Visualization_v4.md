# C3.5 — Visualization v4  
## Визуализация результатов сценарных вычислений  
## (NeuroTransAnalytics v4)

---

## 1. Назначение C3.5 в архитектуре v4

Подуровень **C3.5 (Visualization)** предназначен для **визуального представления**
артефактов, сформированных на уровне **C3.4_Scenario_Computation_v4**.

C3.5 является:

- строго **отображающим** слоем;
- методически нейтральным;
- лишённым вычислительной и интерпретационной логики.

C3.5 обеспечивает **читаемость архитектуры данных и эффектов**,  
но **не делает выводов** и **не трансформирует результаты**.

---

## 2. Принципиальные запреты C3.5

C3.5 **категорически запрещено**:

1. Выполнять любые вычисления (включая агрегацию).
2. Фильтровать данные помимо уже зафиксированного QC-gate.
3. Изменять масштабы, скрывающие реальные распределения.
4. Нормализовать данные «для красоты».
5. Использовать визуальные метафоры, предполагающие интерпретацию
   (например, «оптимум», «норма», «деградация»).

C3.5 **не отвечает** на вопрос *почему* и даже *что это значит* —  
только *как это выглядит*.

---

## 3. Входной контракт C3.5

C3.5 принимает **исключительно стандартизированные артефакты C3.4**:

- `ScenarioResult`
- `DistributionPack`
- `ContrastPack`

Любые визуализации, не имеющие прямого соответствия этим структурам,
считаются **архитектурным нарушением**.

---

## 4. Роль визуализации в проекте NeuroTransAnalytics

В рамках v4 визуализация выполняет **три инженерные функции**:

1. **Экспликация структуры**  
   Делает видимой конфигурацию временной архитектуры реакции.

2. **Обнаружение режимов и границ применимости**  
   Позволяет увидеть:
   - плотность краёв распределений;
   - зоны QC-напряжения;
   - популяционные кластеры.

3. **Подготовка к интерпретации (C4)**  
   Формирует визуальный контекст,
   в котором допустима дальнейшая аналитическая работа.

---

## 5. Базовые типы визуальных артефактов

### 5.1. Распределения компонент (Distribution Views)

Используются для:
- ΔV1
- ΔV4
- ΔV5MT
- RT_total
- долей вкладов (share_V*)

Допустимые формы:
- boxplot (с медианой, IQR, выбросы — как факт, не как ошибка)
- violin / half-violin (без сглаживания, искажающего хвосты)
- empirical CDF (по необходимости)

Запрещено:
- усреднение без отображения разброса;
- визуальное «сжатие» хвостов.

---

### 5.2. Архитектурные конфигурации (Architecture Maps)

Цель — показать **соотношение компонент**, а не абсолютные значения.

Формы:
- stacked bars (доли вкладов ΔV1 / ΔV4 / ΔV5MT)
- ternary-подобные проекции (если реализуемо без интерпретации)
- параллельные координаты (components × conditions)

Используются исключительно данные `share_*` из C3.4.

---

### 5.3. Контрастные представления (Contrast Views)

Используются `ContrastPack`.

Допустимые формы:
- forest plot (эффект + интервал неопределённости)
- paired-difference plot
- signed bar plots (с обязательным указанием нулевой линии)

Обязательное требование:
- **визуально различать**:
  - RawContrast
  - InterpretableContrast (например, насыщенностью или рамкой)

---

### 5.4. PSI-ориентированные визуализации

PSI рассматривается как **ось архитектурного зондирования**.

Формы:
- faceting по `PSI_type`
- линии изменения компонент вдоль PSI
- heatmap взаимодействий `PSI × color × visual_field`
  (только при явной фиксации QC и объёма данных)

Запрещено:
- интерпретировать PSI как «внимание», «ожидание» и т.п.

---

## 6. Латерализация и пространственная организация

Для сценариев A0.3, B2 и смежных:

Допустимые формы:
- зеркальные графики (left vs right)
- центр как отдельная категория, а не «ноль»
- симметричные шкалы

Обязательное требование:
- визуально не навязывать симметрию, если её нет в данных.

---

## 7. Отображение QC и границ применимости

QC в визуализации — **не мусор**, а **информация**.

Допустимые способы:
- подписи доли QC-отфильтрованных trial'ов
- отдельный слой/цвет для flagged данных
- аннотации «low support» при малых n

Запрещено:
- скрывать QC-ограничения;
- визуально «исправлять» проблемные данные.

---

## 8. Универсальный визуализационный пайплайн

Каждая визуализация в C3.5 обязана явно соответствовать схеме:

1. Получен конкретный `ScenarioResult`
2. Выбран тип визуального артефакта
3. Зафиксированы:
   - scenario_id
   - component_algo_version
   - scenario_version
   - QC-gate
4. Визуализация сохранена как воспроизводимый объект

---

## 9. Форматы выходных артефактов

C3.5 допускает следующие форматы:

- статические изображения (PNG / SVG)
- интерактивные панели (если сохраняется воспроизводимость)
- отчётные PDF-фрагменты (как слой над C3.4)

Каждый визуальный артефакт обязан иметь:
- машинно-читаемый идентификатор;
- ссылку на сценарий;
- дату генерации.

---

## 10. Минимальный набор визуализаций для v4

Рекомендуемый стартовый набор:

1. Распределения ΔV1 по условиям (A0.1)
2. Архитектурные доли ΔV1 / ΔV4 / ΔV5MT (A2.0)
3. Контрасты ΔV4 vs ΔV5MT (A1.0)
4. PSI-зависимые профили компонент (B1)
5. Латерализационные карты (A0.3 / B2)

---

## 11. Методологическое резюме

C3.5:

- делает архитектуру реакции **видимой**;
- не подменяет анализ интерпретацией;
- сохраняет все ограничения и допущения явными;
- подготавливает корректный переход к уровню **C4**.

C3.5 — это **окно**, а не **фильтр**.

---
