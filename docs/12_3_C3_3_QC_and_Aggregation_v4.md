# C3.3 — Контроль качества и агрегирование данных (QC & Aggregation v4)

## 1. Назначение документа

Документ описывает **принципы и вычислительные процедуры контроля качества (QC)**
и **агрегирования данных** в проекте *NeuroTransAnalytics* версии v4.

Цель:

* формально отделить контроль качества от интерпретации;
* зафиксировать допустимые и недопустимые виды агрегации;
* сохранить исследовательскую полноту данных без редукций.

C3.3 реализует переход:

> от событийного уровня и компонентных расчётов (C3.1–C3.2)
> к сценарным вычислениям (C3.4).

---

## 2. Методологическая позиция QC

Контроль качества в проекте:

* **не является очисткой данных**;
* **не направлен на улучшение статистических показателей**;
* служит для выявления границ применимости анализа.

QC отвечает на вопрос:

> *на каких данных, при каких условиях, какие вычисления допустимы.*

---

## 3. Уровни контроля качества

### 3.1. Событийный QC

Проверяется:

* корректность связки StimulusEvent ↔ ResponseEvent;
* допустимые диапазоны RT и PSI;
* наличие системных пропусков;
* логическая целостность последовательностей стимулов.

Результат:

* флаги качества на уровне событий;
* без удаления данных.

---

### 3.2. Компонентный QC (ΔV*)

Проверяется:

* вычислимость ΔV1, ΔV4, ΔV5/MT;
* устойчивость компонент по сегментам теста;
* согласованность повторных измерений.

Компоненты:

* не исключаются автоматически;
* маркируются признаками надёжности.

---

## 4. Принципы агрегирования

### 4.1. Агрегация как отдельный вычислительный слой

Агрегация:

* выполняется **только после QC**;
* не заменяет событийные данные;
* всегда воспроизводима из первичных событий.

---

### 4.2. Допустимые виды агрегатов

Допускаются:

* медианные и устойчивые оценки;
* сегментарные агрегаты (старт / середина / конец теста);
* условные агрегаты (по PSI, цвету, позиции);
* популяционные распределения.

---

### 4.3. Ограничения агрегирования

Недопустимо:

* агрегировать данные с различными условиями предъявления;
* скрывать вариабельность за одним средним;
* использовать агрегаты вне сценарного контекста.

---

## 5. Исторические и устойчивые метрики

В проекте допускается параллельное использование:

* исторически применявшихся средних и SD;
* устойчивых показателей (медиана, MAD и др.).

Требование:

* сравнение влияния разных метрик;
* явное указание используемого метода.

---

## 6. Сегментация теста

QC и агрегирование учитывают:

* позицию стимула в последовательности;
* стартовые эффекты;
* нагрузочные срывы;
* асимметрии по сегментам.

Сегментация:

* не является интерпретацией;
* служит для выявления динамики условий.

---

## 7. Хранение агрегатов и QC-метаданных

Результаты QC и агрегирования:

* сохраняются в `AggregateMetrics`;
* содержат ссылки на исходные события;
* включают параметры фильтрации и версии алгоритмов.

---

## 8. Связь с сценарным анализом

C3.3 подготавливает:

* корректные входные данные для C3.4;
* информацию о допустимости тех или иных сценариев;
* основу для интерпретации ограничений результатов.

---

## 9. Итоговая роль документа

C3.3 обеспечивает:

* методически корректный контроль качества;
* осмысленное агрегирование без потери информации;
* защиту проекта от преждевременных редукций.
