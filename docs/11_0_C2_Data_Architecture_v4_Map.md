# Уровень C2 — Архитектура данных и хранения (Data Architecture v4)

## 1. Назначение уровня C2

Уровень **C2** описывает **архитектуру хранения, структурирования и доступа к данным** 
проекта *NeuroTransAnalytics* версии v4.

Его задача — обеспечить:

* сохранение всей многомерности данных без редукции;
* воспроизводимость сценариев анализа A0–B3;
* прямую поддержку методических рекомендаций уровня C1;
* расширяемость под будущие тесты и нагрузки.

Уровень C2 **не вводит новых аналитических интерпретаций** и не изменяет методологию анализа —
он фиксирует, *как данные должны храниться, чтобы всё уже спроектированное было реализуемо*.

---

## 2. Методологические принципы архитектуры v4

### 2.1. Принцип сценарной адресуемости

Каждый результат в базе данных должен быть:

* однозначно связан со сценарием (A0.x, A1.x, A2.x, Bx, Cx);
* воспроизводим без скрытых агрегатов;
* трассируем до исходных событий теста.

---

### 2.2. Принцип нерушимости первичных данных

* сырые данные тестов **никогда не переписываются**;
* любые производные показатели существуют как отдельные сущности;
* допускается хранение нескольких версий производных расчётов.

---

### 2.3. Принцип многослойности

Архитектура данных строится слоями:

* события →
* агрегаты →
* сценарные представления →
* визуализации.

Каждый слой изолирован и явно описан.

---

## 3. Основные сущности данных (Conceptual Entities)

### 3.1. Subject (Испытуемый)

Минимальный набор:

* анонимный идентификатор;
* пол;
* возраст (или возрастная группа);
* дополнительные демографические признаки (опционально).

---

### 3.2. TestSession (Сеанс тестирования)

Описывает:

* дату и время;
* тип теста;
* фазу (Ф₁ / Ф₂ / Ф₃);
* версию конфигурации теста.

---

### 3.3. StimulusEvent (Событие стимула)

Ключевая сущность уровня v4.

Содержит:

* тип стимула (тестовый / маскирующий / промежуточный);
* цвет стимула;
* пространственную локализацию;
* позицию в последовательности;
* PSI_test / PSI_mask / PSI_transition;
* параметры фона;
* идентификатор маскирующей конфигурации.

---

### 3.4. ResponseEvent (Событие реакции)

Содержит:

* время реакции (RT);
* флаги валидности;
* информацию об ошибках и пропусках.

---

## 4. Производные сущности (Derived Entities)

### 4.1. ComponentTiming

Хранит:

* ΔV1;
* ΔV4;
* ΔV5/MT;
* версию алгоритма расчёта;
* параметры фильтрации (MAD и др.).

---

### 4.2. AggregateMetrics

Содержит:

* медианы;
* вариабельность;
* архитектурные разности;
* сегментарные показатели.

Агрегаты **никогда не заменяют** первичные данные.

---

## 5. Сценарный слой (Scenario Layer)

Для каждого сценария:

* хранится список используемых сущностей;
* фиксируется версия сценария;
* сохраняются промежуточные результаты;
* обеспечивается повторяемость расчёта.

---

## 6. Метаданные и версии

Архитектура v4 требует явного хранения:

* версий тестовых конфигураций;
* версий сценариев анализа;
* версий алгоритмов расчёта.

Никакие изменения не происходят «молча».

---

## 7. Поддержка визуализации

Архитектура данных должна:

* поддерживать выборки по любым осям (цвет, PSI, позиция, канал);
* обеспечивать быстрый доступ к временным профилям;
* позволять интерактивную навигацию без перерасчёта данных.

---

## 8. Технические ограничения и реализация

Архитектура v4:

* реализуема на персональном компьютере;
* совместима с Python 3;
* допускает хранение в SQLite / Parquet / HDF5;
* не требует серверной инфраструктуры.

---

## 9. Связь с другими уровнями

* опирается на A0–B3 (что анализируется);
* реализует C1 (как проектировать);
* подготавливает C3 (как считать);
* подготавливает C4 (как визуализировать).

---

## 10. Следующий шаг

После утверждения карты C2 логично:

1. детализировать **C2.1 — логическую модель данных**;
2. затем **C2.2 — физическую реализацию хранения**;
3. и только после этого переходить к C3.
