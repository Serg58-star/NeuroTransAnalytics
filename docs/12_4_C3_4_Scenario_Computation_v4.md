# C3.4 — Scenario Computation v4  
## Сценарные вычисления в архитектуре NeuroTransAnalytics v4

---

## 1. Назначение и место C3.4 в архитектуре v4

Подуровень **C3.4 (Scenario Computation)** является вычислительным слоем,
который реализует **формальные исследовательские сценарии** проекта *NeuroTransAnalytics v4*
на основе:

- компонент временной архитектуры, рассчитанных в **C3.2**;
- результатов контроля качества и допустимости, зафиксированных в **C3.3**.

C3.4 является **переходным слоем** между:
- инфраструктурно-вычислительным уровнем (C3.1–C3.3),
- и аналитико-интерпретационными уровнями (C3.5 — визуализация, C4 — интерпретация и отчётность).

C3.4 **не занимается**:
- очисткой данных;
- пересчётом компонент;
- физиологической интерпретацией;
- визуализацией.

Его задача — **строго воспроизводимое сценарное вычисление**.

---

## 2. Архитектурный принцип C3.4

В архитектуре v4 **каждый сценарий** (A0–A2, B1–B3) трактуется как:

> формализованный запрос к временной архитектуре зрительной реакции  
> при фиксированных правилах допустимости и агрегирования.

Сценарий в C3.4 — это **не код**, а **спецификация вычисления**,
которая может быть реализована любым техническим способом,
но обязана давать воспроизводимый результат.

---

## 3. Контракт входных данных

### 3.1. Event-level данные (из C2 / C3.1)

Используются для:
- реконструкции условий,
- группировки,
- проверки сценарных ограничений.

Минимальный состав:
- `StimulusEvent`
- `ResponseEvent`
- `trial_id`
- `session_id`
- `subject_id`
- `test_id`
- `block_id`
- `position_in_sequence`
- `color`
- `visual_field` (left / center / right)
- `PSI_type` (test / mask / transition)
- `PSI_value`
- `masking_type`
- дополнительные метаданные дизайна

---

### 3.2. Component-level данные (из C3.2)

Единица анализа — **trial**.

Обязательные поля:
- `RT_total`
- `ΔV1`
- `ΔV4`
- `ΔV5MT`
- `component_algo_version`

---

### 3.3. QC-данные (из C3.3)

QC используется как **фильтр применимости**, а не как инструмент очистки.

Обязательные поля:
- `qc_pass` (boolean)
- `qc_flags` (мульти-метки)
- дополнительные QC-индикаторы (преждевременное нажатие, пропуск и т.п.)

---

## 4. Принципиальные ограничения C3.4

C3.4 **запрещено**:

1. Удалять или модифицировать данные.
2. Игнорировать QC-флаги.
3. Вводить новые временные компоненты.
4. Использовать нефомализованные метрики (например, «стабилизация», «нелинейность»).
5. Интерпретировать результаты физиологически или психологически.

---

## 5. Универсальный сценарный вычислительный пайплайн

Каждый сценарий в C3.4 обязан реализовываться через один и тот же логический конвейер:

1. **Select**  
   Отбор данных по условиям сценария.

2. **QC Gate**  
   Применение правила допустимости:
   - `strict` (только qc_pass),
   - `soft` (qc_pass + отмеченные флаги),
   - `flagged_only` (для исследовательских целей).

3. **Group**  
   Формирование групп по сценарным ключам  
   (например: `color × visual_field × PSI_type`).

4. **Aggregate**  
   Расчёт устойчивых метрик компонент и RT.

5. **Contrast**  
   Формирование разностей и subtraction-структур между условиями.

6. **Significance**  
   Непараметрическая оценка значимости эффектов.

7. **Emit**  
   Формирование стандартного выходного артефакта.

---

## 6. Стандартный набор метрик

### 6.1. Базовые метрики (для ΔV1, ΔV4, ΔV5MT, RT)

Допустимы **только устойчивые описатели**:

- медиана
- MAD (или MAD-based scale)
- IQR
- p10 / p90
- доля значений за QC-границами

---

### 6.2. Метрики перераспределения времени (A2)

Используются как **координаты архитектуры**, а не как объяснение:

- `share_V1 = ΔV1 / RT_total`
- `share_V4 = ΔV4 / RT_total`
- `share_V5MT = ΔV5MT / RT_total`

Анализируются:
- абсолютные значения,
- контрасты между условиями,
- популяционные распределения конфигураций.

---

### 6.3. Латерализационные метрики

- `(left − right)` по компонентам и RT
- `(center − periphery)` при наличии центральных стимулов

---

## 7. Правило интерпретируемости контрастов

Каждый контраст обязан иметь **два уровня представления**:

1. **RawContrast**  
   Числовая разность без интерпретации.

2. **InterpretableContrast**  
   Контраст с флагом допустимости интерпретации:

```text
is_interpretable = True / False

Интерпретация запрещена, если эффект статистически не подтверждён.

8. Стандартная структура результата сценария
8.1. ScenarioResult

Обязательные поля:

scenario_id

analysis_unit (trial / session / subject / cohort)

group_keys

metrics

effect_estimates

significance

qc_summary

component_algo_version

scenario_version

8.2. DistributionPack

перцентили

устойчивые меры разброса

формы распределений без предположений о нормальности

8.3. ContrastPack

subtraction-эффекты

интервалы неопределённости

флаги интерпретируемости

9. PSI как инструмент вскрытия архитектуры

В C3.4 PSI трактуется как архитектурный зонд, а не просто условие.

Используются три типа:

PSI_test

PSI_mask

PSI_transition

Допустимы:

прямые сравнения PSI-режимов;

взаимодействия PSI × color × visual_field;

анализ PSI-зависимого перераспределения компонент.

10. Минимальный набор сценариев для первичной реализации C3.4

Рекомендуемый стартовый пакет:

A0.1 — ΔV1 Variability

A0.3 — Architectural Symmetry

A1.0 — Architecture Divergence (ΔV4 vs ΔV5MT)

A2.0 — Temporal Reallocation

B1 — PSI as Architecture Probe

Данный набор покрывает:

базовые метрики,

subtraction-логику,

PSI-зависимые эффекты,

популяционный анализ.

11. Версионность и воспроизводимость

Каждый результат C3.4 обязан явно фиксировать:

версию сценария;

версию алгоритма расчёта компонент;

дату вычисления;

параметры QC-gate;

используемый набор метрик.

Без этих данных результат считается невалидным для дальнейшей интерпретации.

12. Методологическое резюме

C3.4 обеспечивает:

строгую формализацию сценариев;

воспроизводимость вычислений;

защиту от неявных допущений;

готовность данных к визуализации и интерпретации.

C3.4 не отвечает на вопрос «почему»,
но делает возможным корректный переход к этому вопросу на уровне C4.


---
